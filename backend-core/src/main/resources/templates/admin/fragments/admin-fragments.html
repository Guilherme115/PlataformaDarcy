<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- 
    FRAGMENTOS DE ADMINISTRAÇÃO 
    Usados pelo AdminController para retornar HTML parcial via HTMX
-->

<!-- LISTA DE RESULTADOS DA BUSCA DE ALUNOS (COM AÇÕES) -->
<div th:fragment="lista-busca-simples">

    <div th:if="${#lists.isEmpty(resultados)}" class="p-4 text-center text-sm text-gray-500 italic font-mono">
        Nenhum aluno encontrado com esse termo.
    </div>

    <ul th:unless="${#lists.isEmpty(resultados)}" class="divide-y-2 divide-gray-100">
        <li th:each="user : ${resultados}"
            class="p-3 hover:bg-yellow-50 flex justify-between items-center group transition border-l-4 border-transparent hover:border-black">

            <div class="flex items-center gap-3">
                <div
                    class="bg-black text-white w-10 h-10 flex items-center justify-center font-black text-sm border-2 border-black uppercase">
                    <span th:text="${#strings.substring(user.nome, 0, 1)}">A</span>
                </div>
                <div>
                    <h5 class="font-bold text-sm uppercase" th:text="${user.nome}">Aluno Exemplo</h5>
                    <p class="font-mono text-[10px] text-gray-400" th:text="${user.email}">email@aluno.com</p>
                    <p class="font-mono text-[10px] text-gray-500">
                        <span th:text="${user.matricula}">123456</span> •
                        <span th:text="${user.perfil}">ESTUDANTE</span>
                    </p>
                </div>
            </div>

            <!-- Ações Rápidas -->
            <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition">
                <button class="bg-black text-white px-2 py-1 text-[10px] font-bold uppercase hover:bg-gray-800"
                    th:attr="hx-get=@{/admin/usuarios/detalhes/{id}(id=${user.id})}" hx-target="#modal-container">
                    <i data-lucide="user" class="w-3 h-3 inline"></i> PERFIL
                </button>
                <button th:if="${user.perfil != 'ADMIN'}"
                    class="bg-purple-600 text-white px-2 py-1 text-[10px] font-bold uppercase hover:bg-purple-700"
                    th:attr="hx-post=@{/admin/usuarios/promover/{id}(id=${user.id})}" hx-target="closest li"
                    hx-swap="outerHTML">
                    <i data-lucide="crown" class="w-3 h-3 inline"></i> ADMIN
                </button>
                <button th:if="${user.ativo}"
                    class="bg-red-600 text-white px-2 py-1 text-[10px] font-bold uppercase hover:bg-red-700"
                    th:attr="hx-post=@{/admin/usuarios/banir/{id}(id=${user.id})}" hx-target="closest li"
                    hx-swap="outerHTML" hx-confirm="Tem certeza que deseja banir este usuário?">
                    <i data-lucide="ban" class="w-3 h-3 inline"></i> BAN
                </button>
                <button th:unless="${user.ativo}"
                    class="bg-green-600 text-white px-2 py-1 text-[10px] font-bold uppercase hover:bg-green-700"
                    th:attr="hx-post=@{/admin/usuarios/desbanir/{id}(id=${user.id})}" hx-target="closest li"
                    hx-swap="outerHTML">
                    <i data-lucide="check" class="w-3 h-3 inline"></i> ATIVAR
                </button>
            </div>
        </li>
    </ul>

</div>

<!-- USER DETAIL MODAL -->
<div th:fragment="modal-usuario-admin" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50"
    onclick="if(event.target===this)this.remove()">
    <div class="bg-white border-4 border-black shadow-[8px_8px_0px_0px_black] w-full max-w-lg">
        <div class="bg-black text-white p-4 flex justify-between items-center">
            <h3 class="font-black uppercase text-lg">Detalhes do Usuário</h3>
            <button onclick="this.closest('.fixed').remove()" class="text-white hover:text-yellow-400">✕</button>
        </div>
        <div class="p-6 space-y-4">
            <div class="flex items-center gap-4">
                <div
                    class="bg-black text-darcy-yellow w-16 h-16 flex items-center justify-center font-black text-2xl border-2 border-black">
                    <span th:text="${#strings.substring(user.nome, 0, 1)}">A</span>
                </div>
                <div>
                    <h4 class="font-black text-xl uppercase" th:text="${user.nome}">Nome do Usuário</h4>
                    <p class="font-mono text-xs text-gray-500" th:text="${user.email}">email@exemplo.com</p>
                </div>
            </div>
            <div class="grid grid-cols-2 gap-4 border-t-2 border-gray-100 pt-4">
                <div>
                    <span class="font-mono text-[10px] text-gray-400 uppercase block">Matrícula</span>
                    <span class="font-bold" th:text="${user.matricula ?: 'N/A'}">123456</span>
                </div>
                <div>
                    <span class="font-mono text-[10px] text-gray-400 uppercase block">Perfil</span>
                    <span class="font-bold" th:text="${user.perfil}">ESTUDANTE</span>
                </div>
                <div>
                    <span class="font-mono text-[10px] text-gray-400 uppercase block">Status</span>
                    <span th:if="${user.ativo}" class="text-green-600 font-bold">ATIVO</span>
                    <span th:unless="${user.ativo}" class="text-red-600 font-bold">BANIDO</span>
                </div>
                <div>
                    <span class="font-mono text-[10px] text-gray-400 uppercase block">Provider</span>
                    <span class="font-bold" th:text="${user.provider ?: 'LOCAL'}">LOCAL</span>
                </div>
            </div>
        </div>
    </div>
</div>

</html>