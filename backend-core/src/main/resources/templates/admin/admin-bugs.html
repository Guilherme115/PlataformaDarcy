<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/base}"
    th:with="bodyClass='bg-[#f5f5f5] font-sans text-black min-h-screen', showNav=false">

<head>
    <title>Bug Tracker - Admin</title>
</head>

<body>
    <div layout:fragment="content" class="flex min-h-screen">

        <!-- SIDEBAR -->
        <aside class="w-64 bg-white border-r-3 border-black flex flex-col shrink-0">
            <div class="p-6 border-b-3 border-black">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-[#fbbf24] flex items-center justify-center border-2 border-black">
                        <span class="font-serif font-black text-2xl text-black italic">D.</span>
                    </div>
                    <div>
                        <div class="text-black font-black text-lg tracking-tight">DARCY</div>
                        <div class="text-[10px] font-mono text-red-600 uppercase font-bold">Admin Panel</div>
                    </div>
                </div>
            </div>

            <nav class="flex-1 py-4">
                <div class="px-4 py-2 text-[10px] font-mono text-gray-400 uppercase tracking-wider">Principal</div>
                <a href="/admin"
                    class="block px-5 py-3 text-xs font-bold uppercase text-gray-600 hover:bg-gray-50 border-l-3 border-transparent hover:border-[#fbbf24]">
                    <i data-lucide="layout-dashboard" class="w-4 h-4 inline mr-2"></i> Dashboard
                </a>
                <a href="/admin/usuarios"
                    class="block px-5 py-3 text-xs font-bold uppercase text-gray-600 hover:bg-gray-50 border-l-3 border-transparent hover:border-[#fbbf24]">
                    <i data-lucide="users" class="w-4 h-4 inline mr-2"></i> Usuários
                </a>
                <a href="/admin/pdfs"
                    class="block px-5 py-3 text-xs font-bold uppercase text-gray-600 hover:bg-gray-50 border-l-3 border-transparent hover:border-[#fbbf24]">
                    <i data-lucide="file-text" class="w-4 h-4 inline mr-2"></i> Central PDFs
                </a>

                <div class="px-4 py-2 mt-4 text-[10px] font-mono text-gray-400 uppercase tracking-wider">Sistema</div>
                <a href="/admin/bugs"
                    class="block px-5 py-3 text-xs font-bold uppercase bg-gray-100 border-l-3 border-red-500 text-red-600">
                    <i data-lucide="bug" class="w-4 h-4 inline mr-2"></i> Bug Tracker
                </a>
            </nav>

            <div class="p-4 border-t-3 border-black">
                <a href="/" class="block text-xs font-bold uppercase text-gray-500 hover:text-black">
                    <i data-lucide="arrow-left" class="w-4 h-4 inline mr-2"></i> Voltar ao Site
                </a>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 p-8">

            <header class="flex justify-between items-end mb-8 border-b-4 border-black pb-4">
                <div>
                    <h1 class="text-4xl font-black uppercase tracking-tighter italic flex items-center gap-3">
                        <i data-lucide="bug" class="w-10 h-10 text-red-600"></i> Bug Tracker
                    </h1>
                    <p class="text-sm font-mono text-gray-500 font-bold uppercase tracking-widest mt-1">Gerenciamento de
                        Bugs Reportados</p>
                </div>
                <div class="flex gap-2">
                    <span class="bg-red-100 border-2 border-red-600 text-red-800 px-4 py-2 font-bold text-sm"
                        th:text="${#lists.size(bugs)} + ' PENDENTES'">0 PENDENTES</span>
                </div>
            </header>

            <!-- Filtros -->
            <div class="bg-white border-3 border-black p-4 mb-6 shadow-[4px_4px_0_black] flex gap-4 flex-wrap">
                <select
                    class="border-2 border-black px-4 py-2 font-mono text-sm uppercase bg-gray-50 focus:outline-none">
                    <option>Todos</option>
                    <option>UI</option>
                    <option>PERFORMANCE</option>
                    <option>CRASH</option>
                </select>
                <div class="flex-1 flex items-center border-2 border-black px-4 bg-gray-50">
                    <i data-lucide="search" class="w-4 h-4 text-gray-400 mr-2"></i>
                    <input type="text" placeholder="BUSCAR BUG..."
                        class="w-full bg-transparent py-2 focus:outline-none font-mono text-sm uppercase">
                </div>
            </div>

            <!-- Lista de Bugs -->
            <div class="space-y-4">
                <div th:each="bug : ${bugs}"
                    class="bg-white border-3 border-black shadow-[4px_4px_0_black] hover:shadow-[6px_6px_0_black] hover:-translate-x-[2px] hover:-translate-y-[2px] transition-all">

                    <div class="flex">
                        <!-- Status -->
                        <div class="w-16 flex items-center justify-center border-r-3 border-black"
                            th:classappend="${bug.resolvido} ? 'bg-green-500' : 'bg-red-500'">
                            <i th:if="${!bug.resolvido}" data-lucide="alert-circle" class="w-6 h-6 text-white"></i>
                            <i th:if="${bug.resolvido}" data-lucide="check-circle" class="w-6 h-6 text-white"></i>
                        </div>

                        <!-- Conteúdo -->
                        <div class="flex-1 p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                    <span class="text-[10px] font-mono text-gray-400 uppercase"
                                        th:text="'#' + ${bug.id}">ID</span>
                                    <span class="ml-2 px-2 py-0.5 text-[9px] font-bold uppercase border-2"
                                        th:classappend="${bug.categoria == 'CRASH'} ? 'bg-red-100 border-red-600 text-red-800' : (${bug.categoria == 'PERFORMANCE'} ? 'bg-yellow-100 border-yellow-600 text-yellow-800' : 'bg-blue-100 border-blue-600 text-blue-800')"
                                        th:text="${bug.categoria}">UI</span>
                                    <h3 class="font-black text-lg uppercase mt-1" th:text="${bug.titulo}">Bug Title</h3>
                                </div>
                                <div class="text-right">
                                    <div class="text-[10px] font-mono text-gray-400"
                                        th:text="${#temporals.format(bug.dataReport, 'dd/MM/yyyy HH:mm')}">DATA</div>
                                    <div class="text-[10px] font-bold text-gray-500 uppercase"
                                        th:text="${bug.usuario?.nome ?: 'Anônimo'}">USUARIO</div>
                                </div>
                            </div>

                            <p class="text-sm text-gray-600 mt-2 font-mono line-clamp-2" th:text="${bug.descricao}">
                                Descrição do bug...</p>

                            <div class="flex justify-between items-center mt-4 pt-3 border-t-2 border-gray-100">
                                <div class="flex gap-2 text-[9px] font-mono text-gray-400">
                                    <span th:if="${bug.urlOrigem}" class="flex items-center gap-1">
                                        <i data-lucide="link" class="w-3 h-3"></i> <span
                                            th:text="${bug.urlOrigem}">URL</span>
                                    </span>
                                    <span th:if="${bug.resolucaoTela}" class="flex items-center gap-1">
                                        <i data-lucide="monitor" class="w-3 h-3"></i> <span
                                            th:text="${bug.resolucaoTela}">1920x1080</span>
                                    </span>
                                </div>

                                <div class="flex gap-2">
                                    <button th:if="${!bug.resolvido}"
                                        th:attr="hx-post=@{/admin/bug/resolver/{id}(id=${bug.id})}" hx-swap="outerHTML"
                                        hx-target="closest div.bg-white"
                                        class="px-4 py-2 bg-green-500 text-white font-bold text-xs uppercase border-2 border-black hover:bg-green-600 transition flex items-center gap-1">
                                        <i data-lucide="check" class="w-4 h-4"></i> Resolver
                                    </button>
                                    <button th:if="${bug.resolvido}"
                                        class="px-4 py-2 bg-gray-200 text-gray-500 font-bold text-xs uppercase border-2 border-gray-300 cursor-not-allowed">
                                        <i data-lucide="check-circle" class="w-4 h-4 inline"></i> Resolvido
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div th:if="${#lists.isEmpty(bugs)}"
                    class="bg-white border-3 border-black p-12 text-center shadow-[4px_4px_0_black]">
                    <i data-lucide="check-circle-2" class="w-16 h-16 text-green-500 mx-auto mb-4"></i>
                    <h3 class="font-black text-xl uppercase">Nenhum Bug Pendente!</h3>
                    <p class="text-sm text-gray-500 font-mono mt-2">Todos os bugs reportados foram resolvidos.</p>
                </div>
            </div>

        </main>
    </div>

    <script>
        lucide.createIcons();
    </script>
</body>

</html>