<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/base}"
      th:with="bodyClass='bg-white p-6 min-h-screen font-sans text-black border-t-[20px] border-black'">

<head>
  <title>Painel de Comando - Darcy</title>

  <th:block layout:fragment="head-extras">
    <style>
      /* Mantenha aqui APENAS se não estiver no base.html */
      .card-container {
          border: 4px solid black;
          background: white;
          box-shadow: 6px 6px 0px 0px black;
          display: flex;
          flex-direction: column;
          overflow: hidden;
          height: 100%; /* Pequeno ajuste para garantir altura */
      }
      .header-section {
          padding: 0.75rem;
          font-family: 'JetBrains Mono', monospace;
          font-weight: 800;
          text-transform: uppercase;
          border-bottom: 4px solid black;
          display: flex;
          justify-content: space-between;
          align-items: center;
          color: white;
      }
      .btn-action {
          border: 2px solid black;
          font-weight: 800;
          text-transform: uppercase;
          font-size: 0.65rem;
          padding: 4px 12px;
          transition: all 0.1s;
          background: white;
          color: black;
          cursor: pointer;
      }
      .btn-action:hover { transform: translate(-2px, -2px); box-shadow: 3px 3px 0px black; }
      .btn-action:active { transform: translate(0, 0); box-shadow: 0 0 0 black; }
    </style>
  </th:block>
</head>

<body>

<div layout:fragment="content">

  <header class="flex justify-between items-center mb-8 border-b-4 border-black pb-4">
    <div class="flex items-center gap-4">
      <div class="w-12 h-12 bg-[#fbbf24] border-4 border-black flex items-center justify-center text-3xl font-black shadow-[3px_3px_0px_0px_black]">D.</div>
      <div>
        <h1 class="text-3xl font-black uppercase italic tracking-tighter leading-none">PAINEL DE COMANDO</h1>
        <p class="text-[10px] font-mono text-gray-500 uppercase tracking-widest font-bold">Visão Geral do Sistema // Admin Mode</p>
      </div>
    </div>
    <div class="flex items-center gap-6">
      <div class="hidden md:flex px-4 py-1 bg-green-100 border-2 border-green-600 text-green-700 font-mono text-xs font-bold items-center gap-2 rounded-full">
        <div class="w-2 h-2 bg-green-600 rounded-full animate-pulse"></div> SERVER: ONLINE
      </div>
      <a href="/logout" class="font-bold text-sm hover:underline decoration-4 decoration-black uppercase tracking-widest text-black">SAIR</a>
    </div>
  </header>

  <main class="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">

    <div class="flex flex-col gap-8">
      <div class="card-container h-96">
        <div class="header-section bg-black">
          <span class="flex items-center gap-2"><i data-lucide="layers" class="w-4 h-4"></i> GESTÃO DE PROVAS</span>
        </div>
        <div class="p-3 border-b-4 border-black flex justify-between items-center bg-gray-50 text-[10px] font-mono font-bold">
          <span class="text-gray-500"><span th:text="${provas.size()}">0</span> ATIVAS / ARQUIVADAS</span>
          <a href="/cms" class="bg-black text-white px-3 py-1 hover:bg-gray-800 transition uppercase">+ NOVA</a>
        </div>
        <div class="flex-1 overflow-y-auto">
          <table class="w-full text-left text-sm font-mono">
            <tbody class="divide-y-2 divide-gray-100">
            <tr th:each="p : ${provas}" class="hover:bg-yellow-50 cursor-pointer transition group"
                th:attr="hx-get=@{/admin/detalhes/prova/{id}(id=${p.id})}" hx-target="#modal-container">
              <td class="p-3 pl-4 font-bold group-hover:underline uppercase text-xs">
                PAS <span th:text="${p.etapa}">3</span> - <span th:text="${p.ano}">2025</span>
              </td>
              <td class="p-3 text-right pr-4">
                <span th:if="${p.ativo}" class="text-green-600 border-2 border-green-600 px-1 text-[9px] font-black">ON</span>
                <span th:unless="${p.ativo}" class="text-yellow-600 border-2 border-yellow-600 px-1 text-[9px] font-black">DRAFT</span>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="card-container bg-black border-black shadow-hard">
        <div class="header-section border-b-0 bg-black">
          <span class="flex items-center gap-2"><i data-lucide="users" class="w-4 h-4"></i> BASE DE USUÁRIOS</span>
          <span class="text-[#fbbf24] text-xl" th:text="${totalUsuarios}">1.248</span>
        </div>
        <div class="p-4 bg-white border-t-4 border-black">
          <div class="flex">
            <input type="text" placeholder="BUSCAR ALUNO..."
                   class="w-full border-2 border-black border-r-0 p-3 font-mono text-xs focus:bg-gray-50 outline-none uppercase font-bold"
                   hx-post="/admin/usuarios/buscar-rapido" hx-trigger="keyup changed delay:500ms" hx-target="#resultado-busca">
            <button class="bg-black text-white w-12 flex items-center justify-center border-2 border-black">
              <i data-lucide="search" class="w-5 h-5"></i>
            </button>
          </div>
          <div id="resultado-busca" class="mt-2 min-h-[40px]"></div>
        </div>
      </div>
    </div>

    <div class="flex flex-col gap-8">
      <div class="card-container border-[#dc2626]">
        <div class="header-section bg-[#dc2626]">
          <span class="flex items-center gap-2"><i data-lucide="bug" class="w-4 h-4"></i> BUG TRACKER</span>
          <span class="bg-white text-[#dc2626] text-[10px] px-2 font-black border-2 border-black" th:text="${bugsCriticos} + ' CRÍTICOS'">3 CRÍTICOS</span>
        </div>
        <div class="p-4 space-y-4 h-[500px] overflow-y-auto">
          <div th:each="bug : ${bugs}" class="border-b-2 border-gray-100 pb-4 last:border-0">
            <div class="flex justify-between items-start mb-1">
              <span class="bg-red-100 text-red-600 text-[9px] px-1 font-bold border border-red-600 uppercase">Sistema</span>
              <span class="text-[10px] font-mono text-gray-400">10 MIN</span>
            </div>
            <h4 class="font-bold text-sm mb-3 uppercase leading-tight" th:text="${bug.titulo}">ERRO NO LOGIN</h4>
            <div class="flex gap-2">
              <button class="btn-action" th:attr="hx-get=@{/admin/detalhes/bug/{id}(id=${bug.id})}" hx-target="#modal-container">LOGS</button>
              <button class="btn-action border-green-600 text-green-600" th:attr="hx-post=@{/admin/bug/resolver/{id}(id=${bug.id})}" hx-target="closest div.border-b-2" hx-swap="delete">RESOLVER</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="flex flex-col gap-8">
      <div class="card-container border-[#fbbf24]">
        <div class="header-section bg-[#fbbf24] text-black">
          <span class="flex items-center gap-2 font-black"><i data-lucide="radio" class="w-4 h-4"></i> TRANSMISSÃO</span>
          <div class="w-3 h-3 bg-red-600 rounded-full animate-ping"></div>
        </div>
        <div class="p-4 flex flex-col gap-4">
          <form hx-post="/admin/transmitir" hx-target="#status-msg" class="flex flex-col gap-2">
            <input type="text" name="titulo" placeholder="TÍTULO DO ALERTA" class="border-2 border-black p-3 text-xs font-bold uppercase w-full outline-none focus:bg-yellow-50">
            <textarea name="mensagem" rows="3" placeholder="MENSAGEM..." class="border-2 border-black p-3 text-xs font-mono w-full resize-none outline-none focus:bg-yellow-50"></textarea>
            <button type="submit" class="bg-black text-white py-3 text-xs font-black uppercase tracking-widest hover:bg-gray-800 flex items-center justify-center gap-2">
              <i data-lucide="send" class="w-3 h-3"></i> TRANSMITIR AGORA
            </button>
            <div id="status-msg"></div>
          </form>
        </div>
      </div>

      <div class="card-container border-[#7e22ce]">
        <div class="header-section bg-[#7e22ce]">
          <span class="flex items-center gap-2"><i data-lucide="book-open-check" class="w-4 h-4"></i> MODERAÇÃO WIKI</span>
        </div>
        <div class="p-4 space-y-4">
          <div th:each="wiki : ${wikiEdits}" class="pb-4 border-b-2 border-gray-100 last:border-0">
            <h4 class="font-bold text-xs uppercase" th:text="${wiki.titulo}">ERA VARGAS</h4>
            <p class="text-[10px] font-mono text-gray-500 mb-2">Por: <span th:text="${wiki.autor.nome}">@ALUNO</span></p>
            <div class="flex gap-2">
              <button class="flex-1 border-2 border-black font-bold text-[9px] py-1 uppercase hover:bg-green-50">APROVAR</button>
              <button class="flex-1 border-2 border-black font-bold text-[9px] py-1 uppercase hover:bg-red-50">RECUSAR</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>

  <div id="modal-container"></div>
</div>
</body>
</html>