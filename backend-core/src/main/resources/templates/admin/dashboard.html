<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/base}"
  th:with="bodyClass='flex flex-col min-h-screen text-black font-serif bg-[#f5f5f5]', showNav=false">

<head>
  <title>Painel Admin - Darcy</title>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

  <th:block layout:fragment="head-extras">
    <style>
      /* STRICT NEO BRUTALIST THEME */

      /* Reset & Base */
      .admin-sidebar {
        background: white;
        border-right: 3px solid black;
      }

      .admin-nav-item {
        padding: 12px 16px;
        margin: 4px 12px;
        font-family: 'JetBrains Mono', monospace;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        color: #666;
        border: 2px solid transparent;
        transition: all 0.1s;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .admin-nav-item:hover {
        background: #f0f0f0;
        color: black;
        border: 2px solid black;
        box-shadow: 2px 2px 0 black;
        transform: translate(-1px, -1px);
      }

      .admin-nav-item.active {
        background: #fbbf24;
        color: black;
        border: 2px solid black;
        box-shadow: 2px 2px 0 black;
        transform: translate(-1px, -1px);
      }

      /* Cards */
      .admin-card {
        background: white;
        border: 3px solid black;
        box-shadow: 4px 4px 0 black;
      }

      /* KPI Cards */
      .kpi-card {
        background: white;
        border: 3px solid black;
        box-shadow: 4px 4px 0 black;
        padding: 20px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: all 0.2s;
      }

      .kpi-card:hover {
        transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0 black;
      }

      /* Quick Actions */
      .quick-action {
        background: white;
        border: 3px solid black;
        box-shadow: 4px 4px 0 black;
        padding: 16px;
        display: flex;
        align-items: center;
        gap: 16px;
        transition: all 0.2s;
        cursor: pointer;
      }

      .quick-action:hover {
        background: #fffbeb;
        transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0 black;
      }

      .quick-action .icon-box {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid black;
        background: white;
      }

      /* Feed */
      .feed-item {
        border: 2px solid black;
        margin-bottom: 8px;
        padding: 12px;
        background: white;
        box-shadow: 2px 2px 0 #ccc;
      }

      .feed-item:last-child {
        margin-bottom: 0;
      }

      /* Inputs */
      input,
      select,
      textarea {
        border: 3px solid black !important;
        background: white !important;
        border-radius: 0 !important;
        box-shadow: none !important;
      }

      input:focus,
      select:focus,
      textarea:focus {
        background: #fffbeb !important;
        outline: none !important;
      }

      /* Buttons */
      button[type="submit"] {
        background: black;
        color: white;
        border: 3px solid black;
        text-transform: uppercase;
        font-weight: 800;
        box-shadow: 3px 3px 0 #fbbf24;
        transition: all 0.1s;
      }

      button[type="submit"]:hover {
        transform: translate(-2px, -2px);
        box-shadow: 5px 5px 0 #fbbf24;
      }
    </style>
  </th:block>
</head>

<body>

  <div layout:fragment="content" class="flex min-h-screen">

    <!-- SIDEBAR (WHITE & BRUTAL) -->
    <aside class="admin-sidebar w-64 flex flex-col shrink-0">

      <!-- Logo Area -->
      <div class="p-6 border-b-3 border-black bg-white">
        <div class="flex items-center gap-3">
          <div class="w-12 h-12 bg-[#fbbf24] flex items-center justify-center border-3 border-black">
            <span class="font-serif font-black text-2xl text-black italic">D.</span>
          </div>
          <div>
            <div class="text-black font-black text-lg tracking-tight">DARCY</div>
            <div class="text-[10px] font-mono text-red-600 uppercase font-bold">Admin Panel</div>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="flex-1 py-4 overflow-y-auto">
        <div class="px-5 py-2 text-[10px] font-mono text-[#888] uppercase tracking-wider font-bold">Principal</div>
        <a href="/admin" class="admin-nav-item active">
          <i data-lucide="layout-dashboard" class="w-4 h-4"></i> Dashboard
        </a>
        <a href="/admin/usuarios" class="admin-nav-item">
          <i data-lucide="users" class="w-4 h-4"></i> Usuários
        </a>
        <a href="/admin/pdfs" class="admin-nav-item">
          <i data-lucide="file-text" class="w-4 h-4"></i> Central PDFs
        </a>

        <div class="px-5 py-2 mt-4 text-[10px] font-mono text-[#888] uppercase tracking-wider font-bold">Conteúdo</div>
        <a href="/cms" class="admin-nav-item">
          <i data-lucide="layers" class="w-4 h-4"></i> CMS / Provas
        </a>
        <a href="/admin/simulados-oficiais" class="admin-nav-item">
          <i data-lucide="cpu" class="w-4 h-4"></i> Simulados Oficiais
        </a>
        <a href="/admin/editora" class="admin-nav-item">
          <i data-lucide="book-open" class="w-4 h-4"></i> Editora
        </a>
        <a href="/admin/transmissoes" class="admin-nav-item">
          <i data-lucide="radio" class="w-4 h-4"></i> Transmissões
        </a>
        <a href="/admin/taxonomia" class="admin-nav-item">
          <i data-lucide="tags" class="w-4 h-4"></i> Taxonomia / Tags
        </a>

        <div class="px-5 py-2 mt-4 text-[10px] font-mono text-[#888] uppercase tracking-wider font-bold">Sistema</div>
        <a href="/admin/bugs" class="admin-nav-item">
          <i data-lucide="bug" class="w-4 h-4"></i> Bug Tracker
          <span th:if="${kpi_bugs_criticos > 0}"
            class="ml-auto bg-red-600 text-white text-[9px] px-2 py-0.5 border border-black font-bold"
            th:text="${kpi_bugs_criticos}">0</span>
        </a>
        <a href="#" class="admin-nav-item">
          <i data-lucide="settings" class="w-4 h-4"></i> Configurações
        </a>
      </nav>

      <!-- Footer User -->
      <div class="p-4 border-t-3 border-black bg-white">
        <div class="flex items-center gap-3 mb-4 px-2">
          <div
            class="w-8 h-8 bg-black flex items-center justify-center text-[#fbbf24] border-2 border-black font-bold text-xs">
            AD
          </div>
          <div class="flex-1 min-w-0">
            <div class="text-black text-sm font-bold truncate">Administrador</div>
            <div class="text-[#666] text-[10px] font-mono">Super Admin</div>
          </div>
        </div>

        <a href="/" class="flex items-center gap-2 text-xs font-bold text-black uppercase hover:underline px-2 mb-2">
          <i data-lucide="arrow-left" class="w-3 h-3"></i> Voltar ao Site
        </a>
        <form th:action="@{/logout}" method="post">
          <button
            class="w-full text-left flex items-center gap-2 text-xs font-bold text-red-600 uppercase hover:underline px-2">
            <i data-lucide="log-out" class="w-3 h-3"></i> Sair
          </button>
        </form>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 p-8 overflow-y-auto">

      <!-- Header (Simple & Brutal) -->
      <header class="flex justify-between items-end mb-8 pb-4 border-b-3 border-black">
        <div>
          <div class="flex items-center gap-2 mb-1">
            <div class="w-3 h-3 bg-[#22c55e] border-2 border-black"></div>
            <span class="text-[11px] font-mono text-black uppercase font-bold tracking-wider">Sistema Online</span>
          </div>
          <h1 class="text-5xl font-black text-black tracking-tighter">PAINEL DE COMANDO</h1>
        </div>
        <div class="text-right">
          <div class="text-[12px] font-mono text-black font-bold uppercase"
            th:text="${#dates.format(#dates.createNow(), 'EEEE, dd MMM yyyy')}">DATA COMPLETA</div>
          <div class="text-[32px] font-black text-[#fbbf24] leading-none" style="-webkit-text-stroke: 1px black;">DARCY
            v1.0</div>
        </div>
      </header>

      <!-- KPI ROW -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">

        <div class="kpi-card">
          <div class="flex justify-between items-start mb-2">
            <span class="text-[10px] font-mono text-[#666] uppercase font-bold">Total Usuários</span>
            <i data-lucide="users" class="w-5 h-5 text-black"></i>
          </div>
          <div class="text-4xl font-black text-black" th:text="${kpi_users}">0</div>
          <div
            class="mt-2 inline-block bg-[#dcfce7] border-2 border-black px-2 py-0.5 text-[10px] font-bold text-green-800 self-start">
            +12% RECENTE
          </div>
        </div>

        <div class="kpi-card">
          <div class="flex justify-between items-start mb-2">
            <span class="text-[10px] font-mono text-[#666] uppercase font-bold">Receita (MRR)</span>
            <i data-lucide="dollar-sign" class="w-5 h-5 text-black"></i>
          </div>
          <div class="text-4xl font-black text-black" th:text="${kpi_revenue}">R$ 0</div>
          <div class="mt-2 text-[10px] font-mono text-[#666]">Assinaturas ativas</div>
        </div>

        <div class="kpi-card">
          <div class="flex justify-between items-start mb-2">
            <span class="text-[10px] font-mono text-[#666] uppercase font-bold">Simulados Hoje</span>
            <i data-lucide="play-circle" class="w-5 h-5 text-black"></i>
          </div>
          <div class="text-4xl font-black text-black" th:text="${kpi_simulados_hoje}">0</div>
          <div class="mt-2 text-[10px] font-mono text-[#666]">Engajamento real</div>
        </div>

        <div class="kpi-card bg-red-50">
          <div class="flex justify-between items-start mb-2">
            <span class="text-[10px] font-mono text-red-600 uppercase font-bold">Bugs Pendentes</span>
            <i data-lucide="bug" class="w-5 h-5 text-red-600"></i>
          </div>
          <div class="text-4xl font-black text-red-600" th:text="${kpi_bugs}">0</div>
          <div th:if="${kpi_bugs_criticos > 0}"
            class="mt-2 inline-block bg-red-600 border-2 border-black text-white px-2 py-0.5 text-[10px] font-bold self-start">
            <span th:text="${kpi_bugs_criticos}">0</span> CRÍTICOS
          </div>
        </div>

        <div class="kpi-card bg-[#fbbf24]">
          <div class="flex justify-between items-start mb-2">
            <span class="text-[10px] font-mono text-black uppercase font-bold">Uptime</span>
            <i data-lucide="activity" class="w-5 h-5 text-black"></i>
          </div>
          <div class="text-4xl font-black text-black" th:text="${kpi_uptime}">100%</div>
          <div class="mt-2 text-[10px] font-mono text-black font-bold">Sistema Estável</div>
        </div>
      </div>

      <!-- Quick Actions Grid -->
      <div class="mb-8">
        <h2 class="text-xl font-black text-black mb-4 flex items-center gap-2 uppercase tracking-tight">
          <span class="bg-black text-white px-2">AÇÕES</span> RÁPIDAS
        </h2>

        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4">

          <a href="/admin/pdfs" class="quick-action group">
            <div class="icon-box group-hover:bg-red-500 group-hover:text-white transition-colors">
              <i data-lucide="file-plus" class="w-6 h-6"></i>
            </div>
            <div>
              <div class="font-bold text-sm uppercase">Central PDFs</div>
              <div class="text-[10px] font-mono text-[#666]">Gerenciar</div>
            </div>
          </a>

          <a href="/cms" class="quick-action group">
            <div class="icon-box group-hover:bg-purple-500 group-hover:text-white transition-colors">
              <i data-lucide="layers" class="w-6 h-6"></i>
            </div>
            <div>
              <div class="font-bold text-sm uppercase">CMS</div>
              <div class="text-[10px] font-mono text-[#666]">Editar</div>
            </div>
          </a>

          <a href="/admin/usuarios" class="quick-action group">
            <div class="icon-box group-hover:bg-blue-500 group-hover:text-white transition-colors">
              <i data-lucide="user-plus" class="w-6 h-6"></i>
            </div>
            <div>
              <div class="font-bold text-sm uppercase">Usuários</div>
              <div class="text-[10px] font-mono text-[#666]">Adicionar</div>
            </div>
          </a>

          <a href="/admin/transmissoes" class="quick-action group">
            <div class="icon-box group-hover:bg-[#fbbf24] group-hover:text-black transition-colors">
              <i data-lucide="radio" class="w-6 h-6"></i>
            </div>
            <div>
              <div class="font-bold text-sm uppercase">Transmitir</div>
              <div class="text-[10px] font-mono text-[#666]">Alertar</div>
            </div>
          </a>

          <a href="/admin/editora" class="quick-action group">
            <div class="icon-box group-hover:bg-green-500 group-hover:text-white transition-colors">
              <i data-lucide="book-open" class="w-6 h-6"></i>
            </div>
            <div>
              <div class="font-bold text-sm uppercase">Editora</div>
              <div class="text-[10px] font-mono text-[#666]">Livros</div>
            </div>
          </a>

        </div>
      </div>

      <!-- Two Column Layout -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

        <!-- Feed com Visual Cru -->
        <div class="lg:col-span-2">
          <div class="bg-black text-white p-3 border-3 border-black border-b-0 flex justify-between items-center">
            <h3 class="font-black text-sm uppercase tracking-wider flex items-center gap-2">
              <i data-lucide="activity" class="w-4 h-4 text-[#fbbf24]"></i> Log de Atividades
            </h3>
            <div class="text-[10px] font-mono text-[#fbbf24]">AO VIVO</div>
          </div>
          <div class="admin-card p-4 overflow-y-auto max-h-[350px] bg-[#f0f0f0]">

            <div th:each="log : ${feed}" class="feed-item">
              <div class="flex justify-between items-center mb-1 border-b-2 border-[#eee] pb-1">
                <span class="text-[10px] font-black uppercase bg-black text-white px-1"
                  th:text="${log.tipo}">TIPO</span>
                <span class="text-[10px] font-mono text-[#666]">agora</span>
              </div>
              <p class="text-sm font-bold text-black mt-1" th:text="${log.desc}">Descrição da atividade...</p>
            </div>

            <div th:if="${#lists.isEmpty(feed)}" class="text-center py-10 opacity-50">
              <i data-lucide="clock" class="w-8 h-8 mx-auto mb-2"></i>
              <p class="font-mono text-xs uppercase">Nenhuma atividade recente</p>
            </div>

          </div>
        </div>

        <!-- Right Column Stack -->
        <div class="flex flex-col gap-6">

          <!-- Generator Card -->
          <div>
            <div class="bg-black text-white p-3 border-3 border-black border-b-0">
              <h3 class="font-black text-sm uppercase tracking-wider flex items-center gap-2">
                <i data-lucide="cpu" class="w-4 h-4 text-[#fbbf24]"></i> Gerador I.A.
              </h3>
            </div>
            <div class="admin-card p-4">
              <p class="text-[10px] font-mono text-[#666] mb-3 leading-tight">Gera uma prova inédita completa baseada na
                matriz do PAS.</p>

              <form action="/simulado/oficiais/gerar-novo" method="post" class="space-y-3">
                <div>
                  <label class="block text-[10px] font-bold uppercase mb-1">Etapa</label>
                  <select name="etapa"
                    class="w-full bg-white border-2 border-black p-2 text-xs font-bold focus:bg-[#fffbeb] outline-none">
                    <option value="1">PAS 1</option>
                    <option value="2">PAS 2</option>
                    <option value="3">PAS 3</option>
                  </select>
                </div>
                <div>
                  <label class="block text-[10px] font-bold uppercase mb-1">Senha Admin</label>
                  <input type="password" name="senha" placeholder="••••" required
                    class="w-full p-2 text-xs font-mono border-2 border-black focus:bg-[#fffbeb] outline-none">
                </div>
                <button type="submit"
                  class="w-full bg-black text-white py-2 text-xs font-bold uppercase border-2 border-black hover:bg-[#fbbf24] hover:text-black transition flex items-center justify-center gap-2">
                  <i data-lucide="zap" class="w-3 h-3"></i> Gerar Prova
                </button>
              </form>

              <div th:if="${sucesso}"
                class="mt-3 bg-green-100 border border-green-500 text-green-700 px-3 py-2 text-[10px] font-mono font-bold">
                <i data-lucide="check" class="w-3 h-3 inline mr-1"></i> <span th:text="${sucesso}">Sucesso</span>
              </div>
              <div th:if="${erro}"
                class="mt-3 bg-red-100 border border-red-500 text-red-700 px-3 py-2 text-[10px] font-mono font-bold">
                <i data-lucide="alert-triangle" class="w-3 h-3 inline mr-1"></i> <span th:text="${erro}">Erro</span>
              </div>
            </div>
          </div>

          <!-- Broadcast Form -->
          <div class="bg-[#fbbf24] text-black p-3 border-3 border-black border-b-0">
            <h3 class="font-black text-sm uppercase tracking-wider flex items-center gap-2">
              <i data-lucide="megaphone" class="w-4 h-4"></i> Transmissão
            </h3>
          </div>
          <div class="admin-card p-4">
            <form hx-post="/admin/transmitir" hx-target="#status-msg" class="space-y-4">

              <div>
                <label class="block text-[10px] font-bold uppercase mb-1">Título</label>
                <input type="text" name="titulo" placeholder="Ex: Manutenção..." required
                  class="w-full p-2 text-sm font-bold">
              </div>

              <div>
                <label class="block text-[10px] font-bold uppercase mb-1">Tipo</label>
                <div class="grid grid-cols-3 gap-2">
                  <label class="cursor-pointer">
                    <input type="radio" name="tipo" value="INFO" class="peer hidden" checked>
                    <div
                      class="text-center py-2 text-[10px] font-bold border-2 border-black peer-checked:bg-blue-500 peer-checked:text-white hover:bg-gray-100 transition">
                      INFO</div>
                  </label>
                  <label class="cursor-pointer">
                    <input type="radio" name="tipo" value="ALERTA" class="peer hidden">
                    <div
                      class="text-center py-2 text-[10px] font-bold border-2 border-black peer-checked:bg-red-500 peer-checked:text-white hover:bg-gray-100 transition">
                      ALERTA</div>
                  </label>
                  <label class="cursor-pointer">
                    <input type="radio" name="tipo" value="EVENTO" class="peer hidden">
                    <div
                      class="text-center py-2 text-[10px] font-bold border-2 border-black peer-checked:bg-[#fbbf24] peer-checked:text-black hover:bg-gray-100 transition">
                      EVENTO</div>
                  </label>
                </div>
              </div>

              <div>
                <label class="block text-[10px] font-bold uppercase mb-1">Mensagem</label>
                <textarea name="mensagem" rows="3" required class="w-full p-2 text-sm font-mono"></textarea>
              </div>

              <button type="submit" class="w-full py-3 flex justify-center items-center gap-2">
                <i data-lucide="send" class="w-4 h-4"></i> ENVIAR AGORA
              </button>

              <div id="status-msg"></div>
            </form>
          </div>
        </div>

      </div>

      <!-- Data Injection for Charts (Hidden but present) -->
      <script type="application/json" id="data-chart-labels" th:utext="${chart_labels}"></script>
      <script type="application/json" id="data-chart-users" th:utext="${chart_users}"></script>
      <script type="application/json" id="data-chart-simulados" th:utext="${chart_simulados}"></script>

    </main>
  </div>

  <script>
    lucide.createIcons();
  </script>

</body>

</html>